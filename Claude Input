import React, { useState, createContext, useContext } from 'react';
import { ChevronLeft, Calendar, MapPin, Users, Bell, User, Plus, Search, Star, X, Check, Filter, MessageCircle, Send, LogOut, Home } from 'lucide-react';

// Context for global state
const AppContext = createContext();

const App = () => {
  const [currentUser, setCurrentUser] = useState(null);
  const [users, setUsers] = useState([
    { 
      id: '1', 
      email: 'demo@test.com', 
      password: 'password', 
      firstName: 'Demo',
      nickname: 'DemoPlayer',
      bio: 'Love strategy games and meeting new people!',
      image: ''
    },
    { 
      id: '2', 
      email: 'alice@test.com', 
      password: 'password', 
      firstName: 'Alice',
      nickname: 'BoardQueen',
      bio: 'Competitive player who loves euro games',
      image: ''
    },
    { 
      id: '3', 
      email: 'bob@test.com', 
      password: 'password', 
      firstName: 'Bob',
      nickname: 'DiceRoller',
      bio: 'Casual gamer, here for the fun and snacks!',
      image: ''
    },
    { 
      id: '4', 
      email: 'charlie@test.com', 
      password: 'password', 
      firstName: 'Charlie',
      nickname: 'MeepleKing',
      bio: 'Board game collector with 200+ games',
      image: ''
    },
    { 
      id: '5', 
      email: 'diana@test.com', 
      password: 'password', 
      firstName: 'Diana',
      nickname: 'CardShark',
      bio: 'Love deck-building games!',
      image: ''
    }
  ]);
  const [events, setEvents] = useState([
    {
      id: '1',
      title: 'Catan Night',
      description: 'Join us for an epic Settlers of Catan game!',
      gameName: 'Settlers of Catan',
      date: '2025-12-05',
      time: '19:00',
      location: 'Singapore, Singapore',
      city: 'Singapore',
      country: 'Singapore',
      maxPlayers: 4,
      currentPlayers: 3,
      experience: 'intermediate',
      hostId: '1',
      applicants: [
        { userId: '4', status: 'pending', message: 'Hi! I have a great collection of games and would love to join. I can bring snacks too!' },
        { userId: '5', status: 'pending', message: 'Looking forward to playing Catan with you all!' }
      ],
      attendees: ['1', '2', '3'],
      status: 'upcoming'
    }
  ]);
  const [notifications, setNotifications] = useState({});
  const [reviews, setReviews] = useState({
    '1': [
      { rating: 5, comment: 'Great host!', reviewerId: '2', eventId: '1' },
      { rating: 4, comment: 'Fun game!', reviewerId: '3', eventId: '1' }
    ],
    '2': [
      { rating: 5, comment: 'Very competitive and fun!', reviewerId: '1', eventId: '1' }
    ],
    '3': [
      { rating: 4, comment: 'Super chill player', reviewerId: '1', eventId: '1' }
    ],
    '4': [
      { rating: 5, comment: 'Amazing game collection!', reviewerId: '1', eventId: '1' },
      { rating: 5, comment: 'Very knowledgeable', reviewerId: '2', eventId: '1' }
    ],
    '5': [
      { rating: 4, comment: 'Great at card games', reviewerId: '3', eventId: '1' }
    ]
  });
  const [chats, setChats] = useState({});

  // GameHub - Reloaded
  return (
    <AppContext.Provider value={{
      currentUser, setCurrentUser,
      users, setUsers,
      events, setEvents,
      notifications, setNotifications,
      reviews, setReviews,
      chats, setChats
    }}>
      <BoardGameApp />
    </AppContext.Provider>
  );
};

const BoardGameApp = () => {
  const { currentUser } = useContext(AppContext);
  const [screen, setScreen] = useState('home');
  const [selectedEvent, setSelectedEvent] = useState(null);
  const [backHandler, setBackHandler] = useState(null);

  // Reset to home when user logs in
  React.useEffect(() => {
    if (currentUser) {
      setScreen('home');
    }
  }, [currentUser]);

  if (!currentUser) {
    return <AuthScreen />;
  }

  const renderScreen = () => {
    switch (screen) {
      case 'home':
        return <HomeScreen onNavigate={setScreen} onSelectEvent={setSelectedEvent} />;
      case 'eventDetail':
        return <EventDetailScreen event={selectedEvent} onBack={() => setScreen('home')} onNavigate={setScreen} />;
      case 'createEvent':
        return <CreateEventScreen onBack={() => setScreen('home')} />;
      case 'myEvents':
        return (
          <div className="p-4">
            <MyEventsScreen onNavigate={setScreen} onSelectEvent={setSelectedEvent} />
          </div>
        );
      case 'notifications':
        return (
          <div className="p-4 space-y-3">
            <NotificationsScreen onBack={() => setScreen('home')} onNavigate={setScreen} onSelectEvent={setSelectedEvent} />
          </div>
        );
      case 'manageApplicants':
        return <ManageApplicantsScreen 
          event={selectedEvent} 
          onBack={() => setScreen('myEvents')} 
          onEventFull={(event) => { setSelectedEvent(event); setScreen('eventDetail'); }}
          setBackHandler={setBackHandler}
        />;
      case 'reviewEvent':
        return <ReviewEventScreen event={selectedEvent} onBack={() => setScreen('home')} />;
      case 'chat':
        return <EventChatScreen event={selectedEvent} onBack={() => setScreen('eventDetail')} />;
      case 'groupChats':
        return <GroupChatsScreen onBack={() => setScreen('home')} />;
      case 'profile':
        return <ProfileScreen onBack={() => setScreen('home')} />;
      default:
        return <HomeScreen onNavigate={setScreen} onSelectEvent={setSelectedEvent} />;
    }
  };

  return (
    <div className="max-w-md mx-auto bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 min-h-screen flex flex-col">
      <Header onNavigate={setScreen} currentScreen={screen} onBack={backHandler} />
      <div className="flex-1 overflow-y-auto pb-20">
        {renderScreen()}
      </div>
      <BottomNav currentScreen={screen} onNavigate={setScreen} />
    </div>
  );
};

const Header = ({ onNavigate, currentScreen, onBack }) => {
  const { currentUser, notifications } = useContext(AppContext);
  const userNotifications = notifications[currentUser?.id] || [];
  const unreadCount = userNotifications.filter(n => !n.read).length;

  const getTitle = () => {
    switch(currentScreen) {
      case 'myEvents':
        return 'My Events';
      case 'notifications':
        return 'Notifications';
      case 'groupChats':
        return 'Group Chats';
      case 'profile':
        return 'Profile';
      case 'createEvent':
        return 'Create Event';
      case 'eventDetail':
        return 'Event Details';
      case 'chat':
        return 'Event Chat';
      case 'manageApplicants':
        return 'Manage Applicants';
      case 'reviewEvent':
        return 'Review Event';
      default:
        return 'GameHub';
    }
  };

  const showBackButton = currentScreen !== 'home';

  const handleBack = () => {
    if (onBack) {
      onBack();
    } else {
      onNavigate('home');
    }
  };

  return (
    <div className="bg-orange-500 text-white p-4 flex justify-between items-center shadow-lg">
      <div className="w-10">
        {showBackButton && (
          <button onClick={handleBack} className="hover:scale-110 transition-transform">
            <ChevronLeft size={24} />
          </button>
        )}
      </div>
      <h1 className="text-2xl font-bold tracking-wide">{getTitle()}</h1>
      <button onClick={() => onNavigate('notifications')} className="relative hover:scale-110 transition-transform">
        <Bell size={24} />
        {unreadCount > 0 && (
          <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold animate-pulse">
            {unreadCount}
          </span>
        )}
      </button>
    </div>
  );
};

const BottomNav = ({ currentScreen, onNavigate }) => {
  const navItems = [
    { id: 'home', label: 'Home', icon: Home },
    { id: 'myEvents', label: 'My Events', icon: Calendar },
    { id: 'createEvent', label: 'Create', icon: Plus },
    { id: 'groupChats', label: 'Groups', icon: MessageCircle },
    { id: 'profile', label: 'Profile', icon: User }
  ];

  return (
    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg">
      <div className="max-w-md mx-auto flex justify-around items-center py-2">
        {navItems.map(item => {
          const Icon = item.icon;
          const isActive = currentScreen === item.id;
          const isCreateButton = item.id === 'createEvent';
          
          if (isCreateButton) {
            return (
              <button
                key={item.id}
                onClick={() => onNavigate(item.id)}
                className="flex flex-col items-center justify-center p-2 -mt-6"
              >
                <div className="bg-gradient-to-r from-purple-600 to-orange-500 text-white rounded-full p-4 shadow-lg">
                  <Icon size={24} />
                </div>
              </button>
            );
          }
          
          return (
            <button
              key={item.id}
              onClick={() => onNavigate(item.id)}
              className={`flex flex-col items-center justify-center p-2 min-w-[60px] transition-colors ${
                isActive 
                  ? 'text-purple-600' 
                  : 'text-gray-400'
              }`}
            >
              <Icon size={24} />
              <span className="text-xs mt-1 font-medium">{item.label}</span>
            </button>
          );
        })}
      </div>
    </div>
  );
};

const AuthScreen = ({ onLogin }) => {
  const { users, setUsers, setCurrentUser } = useContext(AppContext);
  const [isSignUp, setIsSignUp] = useState(false);
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [firstName, setFirstName] = useState('');
  const [nickname, setNickname] = useState('');
  const [error, setError] = useState('');

  const handleSubmit = () => {
    setError('');

    if (isSignUp) {
      if (users.find(u => u.email === email)) {
        setError('Email already exists');
        return;
      }
      const newUser = {
        id: Date.now().toString(),
        email,
        password,
        firstName,
        nickname,
        bio: '',
        image: ''
      };
      const updatedUsers = [...users, newUser];
      setUsers(updatedUsers);
      setCurrentUser(newUser);
    } else {
      const user = users.find(u => u.email === email && u.password === password);
      if (user) {
        setCurrentUser(user);
      } else {
        setError('Invalid credentials. Please check email and password.');
        return;
      }
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50 flex items-center justify-center p-4">
      <div className="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
        <div className="text-center mb-6">
          <h2 className="text-4xl font-bold bg-gradient-to-r from-purple-600 to-orange-500 bg-clip-text text-transparent mb-2">
            GameHub
          </h2>
          <p className="text-gray-600">Connect. Play. Enjoy.</p>
        </div>
        <h3 className="text-2xl font-bold text-center mb-6 text-gray-800">
          {isSignUp ? 'Join GameHub' : 'Welcome Back'}
        </h3>
        <div className="space-y-4">
          {isSignUp && (
            <>
              <input
                type="text"
                placeholder="First Name"
                value={firstName}
                onChange={(e) => setFirstName(e.target.value)}
                className="w-full p-3 border rounded-lg"
                required
              />
              <input
                type="text"
                placeholder="Nickname"
                value={nickname}
                onChange={(e) => setNickname(e.target.value)}
                className="w-full p-3 border rounded-lg"
                required
              />
            </>
          )}
          <input
            type="email"
            placeholder="Email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="w-full p-3 border rounded-lg"
            required
          />
          <input
            type="password"
            placeholder="Password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full p-3 border rounded-lg"
            required
          />
          {error && <p className="text-red-500 text-sm">{error}</p>}
          <button 
            type="button" 
            onClick={handleSubmit}
            className="w-full bg-gradient-to-r from-purple-600 to-orange-500 text-white p-3 rounded-lg font-semibold hover:shadow-lg transition-all transform hover:scale-105"
          >
            {isSignUp ? 'Create Account' : 'Log In'}
          </button>
        </div>
        <p className="text-center mt-4 text-gray-600">
          {isSignUp ? 'Already have an account?' : "Don't have an account?"}{' '}
          <button onClick={() => setIsSignUp(!isSignUp)} className="text-purple-600 font-semibold hover:text-orange-500 transition">
            {isSignUp ? 'Log In' : 'Sign Up'}
          </button>
        </p>
        <div className="mt-4 p-3 bg-gray-100 rounded text-sm">
          <p className="font-semibold">Demo Account:</p>
          <p>Email: demo@test.com</p>
          <p>Password: password</p>
        </div>
      </div>
    </div>
  );
};

const HomeScreen = ({ onNavigate, onSelectEvent }) => {
  const { currentUser, events, users } = useContext(AppContext);
  const [searchTerm, setSearchTerm] = useState('');
  const [showFilters, setShowFilters] = useState(false);
  const [filterCity, setFilterCity] = useState('');
  const [filterDate, setFilterDate] = useState('');
  const [filterExperience, setFilterExperience] = useState('');

  const upcomingEvents = events.filter(e => e.status === 'upcoming');
  
  // Filter out full events unless user is an attendee or has a pending application
  const visibleEvents = upcomingEvents.filter(e => {
    const isFull = e.attendees.length >= e.maxPlayers;
    const isAttendee = e.attendees.includes(currentUser.id);
    const hasPendingApplication = e.applicants.some(a => a.userId === currentUser.id);
    
    // Show event if: not full, OR user is attending, OR user has pending application
    return !isFull || isAttendee || hasPendingApplication;
  });
  
  const filteredEvents = visibleEvents.filter(e => {
    const matchesSearch = e.title.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         e.gameName.toLowerCase().includes(searchTerm.toLowerCase());
    const matchesCity = !filterCity || e.city.toLowerCase().includes(filterCity.toLowerCase());
    const matchesDate = !filterDate || e.date === filterDate;
    const matchesExperience = !filterExperience || e.experience === filterExperience;
    
    return matchesSearch && matchesCity && matchesDate && matchesExperience;
  });

  const clearFilters = () => {
    setFilterCity('');
    setFilterDate('');
    setFilterExperience('');
  };

  const hasActiveFilters = filterCity || filterDate || filterExperience;

  const getHostName = (hostId) => {
    const host = users.find(u => u.id === hostId);
    return host?.nickname || host?.firstName || 'Unknown';
  };

  return (
    <div className="p-4">
      <div className="relative mb-6">
        <Search className="absolute left-3 top-3 text-gray-400" size={20} />
        <input
          type="text"
          placeholder="Search events or games..."
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
          className="w-full pl-10 pr-12 p-3 border-2 border-gray-200 rounded-xl focus:border-purple-400 focus:outline-none transition"
        />
        <button
          onClick={() => setShowFilters(!showFilters)}
          className={`absolute right-3 top-3 ${hasActiveFilters ? 'text-purple-600' : 'text-gray-400'}`}
        >
          <Filter size={20} />
        </button>
      </div>

      {showFilters && (
        <div className="bg-white border-2 border-purple-100 rounded-2xl p-4 mb-6 space-y-4 shadow-lg">
          <h4 className="font-bold text-lg text-gray-800">Filters</h4>
          
          <div>
            <label className="block text-sm font-bold mb-2 text-gray-700">City</label>
            <input
              type="text"
              placeholder="Enter city..."
              value={filterCity}
              onChange={(e) => setFilterCity(e.target.value)}
              className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-purple-400 focus:outline-none transition"
            />
          </div>

          <div>
            <label className="block text-sm font-bold mb-2 text-gray-700">Date</label>
            <input
              type="date"
              value={filterDate}
              onChange={(e) => setFilterDate(e.target.value)}
              min={new Date().toISOString().split('T')[0]}
              className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-purple-400 focus:outline-none transition"
            />
          </div>

          <div>
            <label className="block text-sm font-bold mb-2 text-gray-700">Experience Level</label>
            <select
              value={filterExperience}
              onChange={(e) => setFilterExperience(e.target.value)}
              className="w-full p-2 border-2 border-gray-200 rounded-lg focus:border-purple-400 focus:outline-none transition"
            >
              <option value="">All levels</option>
              <option value="beginner">Beginner</option>
              <option value="intermediate">Intermediate</option>
              <option value="master">Master</option>
            </select>
          </div>

          <div className="flex gap-2 pt-2">
            <button
              onClick={() => setShowFilters(false)}
              className="flex-1 bg-gradient-to-r from-purple-600 to-orange-500 text-white p-3 rounded-xl font-bold hover:shadow-lg transition"
            >
              Apply Filters
            </button>
            {hasActiveFilters && (
              <button
                onClick={clearFilters}
                className="flex-1 bg-gray-200 text-gray-700 p-3 rounded-xl font-bold hover:bg-gray-300 transition"
              >
                Clear
              </button>
            )}
          </div>
        </div>
      )}

      <h3 className="text-2xl font-bold mb-4 text-gray-800">Upcoming Events</h3>
      {filteredEvents.length === 0 && (
        <p className="text-gray-500 text-center py-8">No events found</p>
      )}
      <div className="space-y-3">
        {filteredEvents.map(event => {
          const attendeeProfiles = event.attendees.slice(0, 4).map(id => users.find(u => u.id === id));
          const remainingCount = event.attendees.length - 4;
          
          return (
            <div
              key={event.id}
              onClick={() => {
                onSelectEvent(event);
                onNavigate('eventDetail');
              }}
              className="bg-white border-2 border-gray-100 rounded-2xl p-4 cursor-pointer hover:shadow-xl hover:border-purple-200 transition-all transform hover:-translate-y-1"
            >
              <div className="flex justify-between items-start mb-2">
                <div className="flex-1 pr-2">
                  <h4 className="font-bold text-lg text-gray-900 leading-tight mb-1">{event.title}</h4>
                  <p className="text-sm text-purple-600 font-bold">{event.gameName}</p>
                </div>
                <div className="flex items-start gap-1 text-xs text-gray-600 bg-gray-50 px-2 py-1 rounded-lg">
                  <MapPin size={14} className="text-pink-500 flex-shrink-0 mt-0.5" />
                  <span className="font-medium">{event.city}</span>
                </div>
              </div>
              
              <div className="flex items-center gap-2 text-sm text-gray-600 mb-3">
                <Calendar size={16} className="text-orange-500" />
                <span className="font-medium">{event.date.split('-').reverse().join('/')} ‚Ä¢ {event.time}</span>
              </div>
              
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="flex items-center gap-1.5 text-sm text-gray-700">
                    <Users size={16} className="text-purple-500" />
                    <span className="font-bold">{event.attendees.length}/{event.maxPlayers}</span>
                  </div>
                  {event.experience && (
                    <span className="text-xs bg-gradient-to-r from-purple-100 to-pink-100 text-purple-700 px-3 py-1 rounded-full font-bold">
                      {event.experience.charAt(0).toUpperCase() + event.experience.slice(1)}
                    </span>
                  )}
                </div>
                <div className="flex items-center -space-x-2">
                  {attendeeProfiles.map(attendee => (
                    attendee && (
                      attendee.image ? (
                        <img 
                          key={attendee.id}
                          src={attendee.image} 
                          alt={attendee.nickname} 
                          className="w-7 h-7 rounded-full border-2 border-white object-cover"
                        />
                      ) : (
                        <div 
                          key={attendee.id}
                          className="w-7 h-7 rounded-full border-2 border-white bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white text-xs font-bold"
                        >
                          {attendee.firstName?.charAt(0)}
                        </div>
                      )
                    )
                  ))}
                  {remainingCount > 0 && (
                    <div className="w-7 h-7 rounded-full border-2 border-white bg-gray-300 flex items-center justify-center text-gray-700 text-xs font-bold">
                      +{remainingCount}
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  );
};

// Remaining components would follow the same pattern...
// (EventDetailScreen, CreateEventScreen, MyEventsScreen, etc.)

export default App;
```

---

# üéÆ GameHub - Project Bible

## Project Overview
**GameHub** is a mobile-first React Native app that connects board game enthusiasts to organize and join local game nights. Users can create events, apply to join games, chat with participants, and review their gaming experiences.

## Core Features Implemented

### ‚úÖ User Management
- Email/password authentication (mock for testing)
- User profiles with: First Name, Nickname, Bio, Profile Image (URL)
- 5-star rating system using playing card symbols (‚ô†)
- Review system for hosts and players

### ‚úÖ Event System
- **Event Creation**: Title, Game Name, Description, Date/Time, City/Country, Max Players, Current Players, Experience Level
- **Event Discovery**: Browse upcoming events with search and filters (City, Date, Experience)
- **Application System**: Users apply to join, hosts accept/reject
- **Auto-rejection**: When event fills, remaining applicants auto-rejected with notifications
- **Event Visibility**: Full events hidden from browse (except for attendees/applicants)

### ‚úÖ Communication
- **Event Chat**: Opens when event is full, @mention system with notifications
- **Autocomplete**: @mention suggestions show participant profiles
- **Notifications**: In-app notifications with clickable links to chats

### ‚úÖ Design System
- **Branding**: Orange header, purple-pink-orange gradient theme
- **Typography**: Improved hierarchy with bold headings
- **Event Cards**: Compact design with attendee avatars, experience badges
- **Bottom Navigation**: Home, My Events, Create (elevated), Groups, Profile
- **Dynamic Header**: Title changes based on current screen

## Technical Stack
- React with Hooks (useState, useEffect, useContext)
- Tailwind CSS for styling
- Lucide React for icons
- In-memory state management (no localStorage)

## Known Issues & Backlog

### üêõ Critical Bugs (Pre-Publishing)
1. **Blue bars persist** on My Events, Notifications, Manage Applicants pages
2. **Back navigation broken** in Applicant Details (goes to Home instead of Applicants list)
3. **Logout confirmation modal** - needs custom modal (sandbox blocks window.confirm)

### üìã Pre-Publishing Backlog
1. **Logout Confirmation Modal** - Build custom confirmation dialog
2. **App Store Configuration** - Apple/Google Play metadata, icons, screenshots
3. **Real Authentication & Backend** - Replace mock auth with Firebase/Auth0
4. **Persistent Database** - Replace in-memory state with real database
5. **Push Notifications** - Implement Firebase Cloud Messaging / APNs
6. **File Upload** - Replace image URL input with device photo picker
7. **Remove Blue Bars** - Fix My Events, Notifications, Manage Applicants pages
8. **Fix Back Navigation** - Applicant details ‚Üí Applicants list

### üé® Next Design Task
**Redesign Create Event Page** - Make it more engaging and visually appealing
- Options discussed:
  - Card-based sections with icons
  - Multi-step wizard with progress bar
  - Live preview of event card
  - Interactive date picker, +/- player buttons
  - Visual checkmarks on completion

## Demo Accounts
- **demo@test.com** / password (Demo / DemoPlayer)
- **alice@test.com** / password (Alice / BoardQueen)
- **bob@test.com** / password (Bob / DiceRoller)
- **charlie@test.com** / password (Charlie / MeepleKing)
- **diana@test.com** / password (Diana / CardShark)

## File Structure
```
/src
  ‚îî‚îÄ‚îÄ boardgame-meetup-app.jsx (single-file React component)
